<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>OODuck: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OODuck
   &#160;<span id="projectnumber">0.3</span>
   </div>
   <div id="projectbrief">C Oriented Object framework with duck-typing support</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial will teach you how to use OODuck and how to create custom <a class="el" href="struct_class.html" title="Class used to build new class dynamically. ">Class</a>.</p>
<h2>Using OODuck</h2>
<p>In order to use the OODuck dynamic typing, you need the following skeleton:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ooduck/object.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* OODuck not usable yet */</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__static.html#ga7b78420eea629ef862b85d2950ac7989">ooduck_init</a> ();</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* code using OODuck */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="el" href="struct_class.html" title="Class used to build new class dynamically. ">Class</a> are defined in their own header, which must be included to use them:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ooduck/string.h&gt;</span></div>
</div><!-- fragment --><p>All objects and classes are stored in a pointer, hiding implementation:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> *str = <span class="keyword">new</span> (<a class="code" href="struct_string.html">String</a> (), <span class="stringliteral">&quot;Hello world&quot;</span>);</div>
</div><!-- fragment --><p>Methods are accessed dynamically, and their prototype is defined with the help of <code>typedef</code>:</p>
<div class="fragment"><div class="line">String_cstr_m <a class="code" href="struct_string.html#a54025e601e51b86932da9b8745d9d943">cstr</a> = <a class="code" href="group__static.html#gabb9e3d17823733a769c30ab006146fde">method</a> (<a class="code" href="group__static.html#gaeb8ced368e768c5b59f32518476108a4">classOf</a> (str), <span class="stringliteral">&quot;cstr&quot;</span>);</div>
<div class="line">printf (<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="struct_string.html#a54025e601e51b86932da9b8745d9d943">cstr</a> (str));</div>
</div><!-- fragment --><p><b>NB:</b> the methods prototypes are located in the class header (here: <code><a class="el" href="string_8h_source.html">ooduck/string.h</a></code>).</p>
<p>Finally, an object is freed with the <code><a class="el" href="group__static.html#ga16098144d49597bbf26417dcb39d9f8a" title="Free object. ">delete()</a></code> function:</p>
<div class="fragment"><div class="line"><span class="keyword">delete</span> (str)</div>
<div class="line"></div>
<div class="line">## Reference counting</div>
<div class="line"></div>
<div class="line">All objects (<a class="code" href="struct_class.html">Class</a> included) have a reference counter initialized to ``1``.</div>
<div class="line">When <span class="keyword">this</span> counter equals ``0``, the <span class="keywordtype">object</span> is automatically deleted:</div>
<div class="line"></div>
<div class="line">~~~~~~~~~~~~~~~{.c}</div>
<div class="line"><span class="keywordtype">void</span> *str = <span class="keyword">new</span> (<a class="code" href="struct_string.html">String</a> (), <span class="stringliteral">&quot;Hello world&quot;</span>);</div>
<div class="line"><span class="keywordtype">void</span> *str2 = <a class="code" href="struct_object.html#a0db258b1b2c81f071319d5b4430510ea">ref</a> (str);</div>
<div class="line"></div>
<div class="line"><a class="code" href="struct_object.html#a892be1c5131a5b98bf0a35f2ffe4030b">unref</a> (str);   <span class="comment">/* str2 is still accessible */</span></div>
<div class="line"><a class="code" href="struct_object.html#a892be1c5131a5b98bf0a35f2ffe4030b">unref</a> (str2);  <span class="comment">/* the </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">## Creating new classes</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">The first step is to define our Class structure:</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">~~~~~~~~~~~~~~~{.c}</span></div>
<div class="line"><span class="comment">#include &lt;ooduck/_defs/object.h&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">struct MyClass</span></div>
<div class="line"><span class="comment">{</span></div>
<div class="line"><span class="comment">    /* the parent class is Object, so we define a member to allow the pointer</span></div>
<div class="line"><span class="comment">     * to be casted to the parent class.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="struct_object.html">Object</a> _;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> mydata;</div>
<div class="line">};</div>
</div><!-- fragment --><p>A <a class="el" href="struct_class.html" title="Class used to build new class dynamically. ">Class</a> is an <a class="el" href="struct_object.html" title="Base class for everything. ">Object</a>, like everything else, then we can create it with <code><a class="el" href="group__static.html#gaba6d9a91eeeea6a5c41a59549a29d6a6" title="Allocate new object. ">new()</a></code>:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">void</span> *_MyClass = NULL;</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">void</span> *MyClass (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (_MyClass == NULL)</div>
<div class="line">    {</div>
<div class="line">        _MyClass = <span class="keyword">new</span> (</div>
<div class="line">            <a class="code" href="struct_class.html">Class</a> (),               <span class="comment">/* we are creating a new Class */</span></div>
<div class="line">            <span class="stringliteral">&quot;MyClass&quot;</span>,              <span class="comment">/* our class name */</span></div>
<div class="line">            <a class="code" href="struct_object.html">Object</a> (),              <span class="comment">/* parent class */</span></div>
<div class="line">            <span class="keyword">sizeof</span> (<span class="keyword">struct </span>MyClass) <span class="comment">/* in-memory size of our class */</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">/* VTable */</span></div>
<div class="line">            &quot;<a class="code" href="struct_item.html#abadfa85fced518001f3a186830fee0ff">__constructor__</a>&quot;, MyClass_constructor,</div>
<div class="line">            &quot;my_method&quot;, MyClass_my_method,</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* End of VTable */</span></div>
<div class="line">            NULL</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> _MyClass;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now, we can proceed to implementation:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *MyClass_constructor (<span class="keywordtype">void</span> *_self, va_list *app)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* get constructor arguments */</span></div>
<div class="line">    <span class="keywordtype">int</span> data = va_arg (*app, <span class="keywordtype">int</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* call parent constructor */</span></div>
<div class="line">    Class_constructor_m ctor = <a class="code" href="group__static.html#gabb9e3d17823733a769c30ab006146fde">method</a> (<a class="code" href="group__static.html#gaf5d6e937d52fcf457bb9e1a850cafc23">super</a> (MyClass ()), <span class="stringliteral">&quot;__constructor__&quot;</span>);</div>
<div class="line">    <span class="keyword">struct </span>MyClass *<span class="keyword">self</span> = ctor (_self, app);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* do your stuff */</span></div>
<div class="line">    <span class="keyword">self</span>-&gt;mydata = data;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">self</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> MyClass_my_method (<span class="keyword">const</span> <span class="keywordtype">void</span> *_self)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* make sure we have the right object */</span></div>
<div class="line">    <span class="keyword">struct </span>MyClass *<span class="keyword">self</span> = <a class="code" href="group__static.html#gacaebd367926342e0cc82066431bb8e2e">cast</a> (MyClass (), _self);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;mydata;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The last step is to define prototypes for our methods:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> int (*MyClass_my_method_m) (<span class="keyword">const</span> <span class="keywordtype">void</span> *);</div>
</div><!-- fragment --><p>Finally, we can use our new class:</p>
<p>~~~~~~~~~~~~~~~{.c} void *obj = new (MyClass (), 42); MyClass_my_method_m my_method = method (classOf (obj), "my_method");</p>
<p>assert (my_method</p>
<h2>Important notes</h2>
<p>As you can see, we define our class in a <code>static</code> global variable, and make it accessible with a function.</p>
<p>This is not <b>thread-safe</b> at all. You will need to call this function for each class you use <b>before</b> starting new threads.</p>
<p>In a later release, I would like to implement a <b>lock-free</b> algorithm with a set of <em>macros</em>, in order to ease the implementation. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
